\section{Appendix}
\label{sec:appendix}

\subsection{\venera System Manual}

Venera is a command-line tool that hooks into any Android test runner and
instruments your application test suite. It adds event-firing probes at instance
method entries and logs to a human-readable JSON format. Included is an SDK with
an annotation that gives developers control over the instrumentation policy.
Complex probes have a large overhead, but record a huge amount of program state.
Simple probes simply fire events. In the future, probes placement will be based
on historical test run data and a budget.

\subsubsection{Requirements}

To build the project from source, the following tools are required:

\begin{itemize}
  \item Java Development Kit (v.7+) \cite{jdk}
  \item Android SDK (with the latest tools) \cite{androidSDK}
  \item Gradle (v.1.10+) \cite{gradle}
\end{itemize}

We recommend using IntelliJ \cite{intellij}, Android Studio \cite{androidStudio}
or some other Java-centric IDE, although anything is fine in principal.

\subsubsection{Running the Project}

To try \venera on the included Android application (skeleton-android-app), run
from the command line:

\begin{lstlisting}[numbers=none]
cd skeleton-android-app
gradle clean connectedAndroidTest -P=venera
\end{lstlisting}

IntelliJ users can create a skeleton-android-app Gradle build configuration and
run the task {\tt clean connectedAndroidTest} with script parameters {\tt
-P=venera}.

To run \venera on your own Android application, modify the {\tt build.gradle}
file under the {\tt venera-instrumentation} directory to point to your APKs.
You'll need to also provide a Gradle task (or equivalent) to pull the results
from the device in the same way that skeleton-android-app's build.gradle already
does. Note that integration with other Android applications will be made more
intuitive in the future.


\subsection{\jenkinsPlugin System Manual}

The \jenkinsPlugin maintains a HSQL database of standard test artifacts
and their associated Venera JSON logs. It will eventually be responsible for
\venera result presentation and analysis.

\subsubsection{Source Code}

The full source code is freely available at \cite{heisentestPlugin}.

\subsubsection{Requirements}

To build the project from source, the following tools are required:

\begin{itemize}
  \item Java Development Kit (v.7+) \cite{jdk}
  \item Maven (v.3+) \cite{maven}
\end{itemize}

We recommend using IntelliJ \cite{intellij} or some other Java-centric IDE,
although any editor is fine in theory.

\subsubsection{Running the Project}

From the command line:

\begin{lstlisting}[numbers=none]
mvn hpi:run
\end{lstlisting}

IntelliJ users can create a build configuration with type Maven and working
directory set to the root of the project to execute the same command.

\subsubsection{Common Problems}

When executing mvn hpi:run I get {\lq}java.net.BindException: Address already in
use{\rq}.

Something is using the TCP port (probably a previous instance that failed to
shut down correctly). On Linux, running {\tt lsof -i tcp:\$PORT} will give you
the list of processes using TCP port {\tt\$PORT}, which you can then kill with
{\tt kill \$PID}.


\subsection{Supporting Data}

\subsubsection{Full Dalvik Bytecode Example}
\label{sec:sec:full_dalvik_bytecode_example}

\begin{lstlisting}
#1              : (in Lcom/example/MainActivity;)
  name          : 'anExampleMethod'
  type          : '(Ljava/lang/String;I)Ljava/lang/String;'
  access        : 0x0002 (PRIVATE)
  code          -
  registers     : 4
  ins           : 3
  outs          : 2
  insns size    : 5 16-bit code units
024570:                  |[024570] com.example.MainActivity.anExampleMethod:(Ljava/lang/String;I)Ljava/lang/String;
024580: 7120 8503 3200   |0000: invoke-static {v2, v3}, Lcom/example/MainActivity;.appendIntToString:(Ljava/lang/String;I)Ljava/lang/String; // method@0385
024586: 0c00             |0003: move-result-object v0
024588: 1100             |0004: return-object v0
      catches   : (none)
      positions :
        0x0000 line=22
      locals    :
        0x0000 - 0x0005 reg=1 this Lcom/example/MainActivity;
        0x0000 - 0x0005 reg=2 firstArg Ljava/lang/String;
        0x0000 - 0x0005 reg=3 secondArg I
\end{lstlisting}

\subsection{Project Plan and Interim Report}

\include{Reports/ProjectPlan}
\include{Reports/InterimReport}

\subsection{Partial Code Listing}

This section lists a significant portion of the source code that makes up
\venera. Reading code on paper is not ideal --- we suggest checkout out the full
\venera source code with {\tt git} from \cite{heisentestInstrumentation} and the
\jenkinsPlugin source code from \cite{heisentestPlugin}.

\begin{landscape}
\lstinputlisting{../venera/venera-instrumentation/src/./main/java/com/heisentest/venera/Main.java}
\lstinputlisting{../venera/venera-instrumentation/src/./main/java/com/heisentest/venera/VeneraApkProcessor.java}
\lstinputlisting{../venera/venera-instrumentation/src/./main/java/com/heisentest/venera/VeneraApkInstrumenter.java}
\lstinputlisting{../venera/venera-instrumentation/src/./main/java/com/heisentest/venera/transform/dex/VeneraDexTransformer.java}
\lstinputlisting{../venera/venera-instrumentation/src/./main/java/com/heisentest/venera/transform/dex/visitor/SimpleInstanceMethodEntryMethodVisitor.java}
\lstinputlisting{../venera/venera-instrumentation/src/./main/java/com/heisentest/venera/transform/dex/visitor/VeneraRegisterAllocatingMethodVisitor.java}
\end{landscape}
